# Comandos para Configurar Impresora Raspberry Pi - VentApp

## üöÄ CONFIGURACI√ìN AUTOM√ÅTICA (RECOMENDADO)

# Configuraci√≥n completa autom√°tica para Pi SunsetDrive:
cd raspberry-printer
./configure-sunset-pi.sh

# Esto har√° todo autom√°ticamente:
# ‚úÖ Copiar archivos
# ‚úÖ Instalar sistema
# ‚úÖ Configurar dashboard
# ‚úÖ Registrar dispositivo
# ‚úÖ Mostrar URLs de acceso

## üì± ACCESO DIRECTO
# Dashboard: http://192.168.68.62:3000
# Config: http://192.168.68.62:3001

---

## 1. PREPARACI√ìN MANUAL EN TU COMPUTADORA

# Modificar URL base en printer-config.json (si es necesario)
sed -i 's|https://ventapp.com.ar|https://tu-dominio.com|g' raspberry-printer/printer-config.json

# Transferir archivos a la Raspberry Pi
scp -r raspberry-printer/* francolamber@192.168.68.62:~/

## 2. INSTALACI√ìN EN RASPBERRY PI

# Conectar por SSH
sshpass -p 'Dire4327' ssh francolamber@192.168.68.62

# Hacer ejecutable el script de instalaci√≥n
chmod +x ~/install.sh

# Ejecutar instalaci√≥n (como root)
sudo ./install.sh

# El script reiniciar√° autom√°ticamente el sistema

## 3. ACCESO AL DASHBOARD

# Despu√©s del reinicio, el dashboard se abrir√° autom√°ticamente en la Pi
# Tambi√©n puedes acceder desde cualquier dispositivo en la red:

# Dashboard Principal (auto-inicio en la Pi):
# http://192.168.68.62:3000

# Configuraci√≥n Avanzada:
# http://192.168.68.62:3001

# O mostrar gu√≠a de configuraci√≥n desde SSH:
sshpass -p 'Dire4327' ssh francolamber@192.168.68.62
config-printer

## 4. CONFIGURACI√ìN R√ÅPIDA

# Configuraci√≥n r√°pida con todos los par√°metros
cd ~/
./quick-setup.sh "Printer-Cocina-01" "cm123abc456def789" "https://ventapp.com.ar/api"

# O configuraci√≥n paso a paso:
cd ~/printer-client
node setup-printer.js

# Verificar estado del dispositivo
printer-status
# O manualmente:
cd ~/printer-client && node check-printer-status.js

## 5. APROBAR DISPOSITIVO

# El administrador debe aprobar desde el panel de VentApp
# Mientras tanto, puedes verificar el estado peri√≥dicamente:
watch -n 10 'cd ~/printer-client && node check-printer-status.js'

## 6. INICIAR SERVICIO DE IMPRESI√ìN

# Una vez aprobado el dispositivo, habilitar e iniciar el servicio
sudo systemctl enable printer-client.service
sudo systemctl start printer-client.service

# Verificar que el servicio est√© funcionando
sudo systemctl status printer-client.service

## 7. MONITOREO Y MANTENIMIENTO

# Ver logs en tiempo real
printer-logs
# O manualmente:
journalctl -u printer-client.service -f

# Verificar estado de servicios
printer-dashboard     # Estado del dashboard
printer-web          # Estado del servidor de configuraci√≥n
systemctl status printer-client.service  # Estado del cliente

# Reiniciar servicios si es necesario
sudo systemctl restart printer-dashboard.service
sudo systemctl restart printer-client.service
sudo systemctl restart printer-web-server.service

# Acceso remoto al dashboard
# Desde cualquier dispositivo en la red:
# http://IP_DE_LA_PI:3000

# Verificar impresoras conectadas
lsusb | grep -i printer
lpstat -p

# Ver trabajos de impresi√≥n pendientes
lpstat -o

## 8. COMANDOS DE DIAGN√ìSTICO

# Verificar conectividad con el servidor
curl -v https://ventapp.com.ar/api/health

# Verificar configuraci√≥n local
cat ~/printer-client/config.json

# Verificar credenciales (solo propietario puede ver)
ls -la ~/printer-client/credentials.json

# Probar impresi√≥n local
echo "Prueba de impresi√≥n" | lp

# Ver informaci√≥n del sistema
uptime
free -h
df -h

## 9. CONFIGURACI√ìN DE RED WIFI (MANUAL)

# Escanear redes disponibles
sudo nmcli device wifi list

# Conectar a red WiFi
sudo nmcli device wifi connect "NOMBRE_RED" password "CONTRASE√ëA"

# Ver conexiones activas
nmcli connection show --active

# Ver estado de la interfaz de red
ip addr show wlan0

## 10. SOLUCI√ìN DE PROBLEMAS

# Si el servidor web no responde
sudo systemctl restart printer-web-server.service
sudo netstat -tlnp | grep :3001

# Si hay problemas con la impresora
sudo systemctl restart cups
sudo usermod -a -G lpadmin francolamber

# Si hay problemas de red
sudo systemctl restart NetworkManager
ping -c 4 8.8.8.8

# Reconfigurar completamente (CUIDADO: borra configuraci√≥n)
rm -f ~/printer-client/config.json ~/printer-client/credentials.json
sudo ./install.sh

## 11. COMANDOS √öTILES DE ADMINISTRACI√ìN

# Hacer backup de la configuraci√≥n
tar -czf printer-backup-$(date +%Y%m%d).tar.gz ~/printer-client/config.json ~/printer-client/credentials.json

# Ver todos los servicios relacionados
systemctl list-units | grep printer

# Deshabilitar servicios (para mantenimiento)
sudo systemctl stop printer-client.service
sudo systemctl stop printer-web-server.service

# Ver logs del sistema
journalctl --since "1 hour ago" | grep -i printer

## 12. COMANDOS DE DESARROLLO/DEBUG

# Ejecutar cliente manualmente (para debug)
cd ~/printer-client
node printer-client.js

# Ejecutar servidor web manualmente
cd ~/printer-client
node server.js

# Probar configuraci√≥n
cd ~/printer-client
node -e "console.log(JSON.stringify(require('./config.json'), null, 2))"

# Ver variables de entorno
env | grep -i node

## NOTAS IMPORTANTES:

# - Siempre usar 'sudo' para comandos de sistema (systemctl, apt, etc.)
# - Los archivos de configuraci√≥n est√°n en ~/printer-client/
# - Los logs se pueden ver con 'journalctl' o en la interfaz web
# - La interfaz web est√° en puerto 3001
# - El cliente de impresi√≥n se conecta al servidor cada 5 segundos
# - Las credenciales son √∫nicas por dispositivo y se generan autom√°ticamente

## SECUENCIA COMPLETA DE COMANDOS (EJEMPLO):

sshpass -p 'Dire4327' ssh francolamber@192.168.68.62
chmod +x ~/install.sh
sudo ./install.sh
# [Sistema se reinicia]
sshpass -p 'Dire4327' ssh francolamber@192.168.68.62
# Dashboard disponible en http://192.168.68.62:3000
./quick-setup.sh 'Printer-SunsetDrive-01' '58065731-debb-423a-9340-98829fde4a06' 'https://lamber.ngrok.app/api'
printer-status
# [Esperar aprobaci√≥n del admin]
sudo systemctl enable printer-client.service
sudo systemctl start printer-client.service
printer-logs
